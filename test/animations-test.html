<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-dropdown-menu animation tests</title>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../../vaadin-list-box/vaadin-list-box.html">
  <link rel="import" href="mock-item.html">
  <link rel="import" href="../vaadin-dropdown-menu.html">
</head>

<body>
  <test-fixture id="dropdown">
    <template>
      <vaadin-dropdown-menu placeholder="placeholder">
        <template>
          <vaadin-list-box>
            <mock-item>Option 1</mock-item>
            <mock-item>Option 2</mock-item>
            <mock-item>Option 3</mock-item>
          </vaadin-list-box>
        </template>
      </vaadin-dropdown-menu>
    </template>
  </test-fixture>

  <script>
    describe('dropdown with animations', () => {
      let dropdown, input;

      beforeEach(() => {
        dropdown = fixture('dropdown');
        input = dropdown._inputElement;
      });

      it('should not fail when quick toggling because of animations', (done) => {
        input.click();
        document.activeElement.click();
        input.click();
        document.activeElement.click();

        // there's no event indicating that dropdown has been closed and animations are finished
        // using the timeout with a magic number
        setTimeout(() => {
          expect(dropdown._overlayElement.opened).to.be.false;
          done();
        }, 200);
      });
    });
  </script>
</body>
